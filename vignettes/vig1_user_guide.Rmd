---
title: "vig1_user_guide"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vig1_user_guide}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(BayesRates)
library(dplyr)
library(ggplot2)
```


```{r}
ans <- smooth.agetime(nevent_df = nz_divorces,
                      py_df = nz_population,
                      model_age = RW2(),
                      model_time = AR1(),
                      byvar = "sex")
```


```{r}
ans_df <- augment(ans)
```

```{r, fig.width = 7, fig.height = 7}
ggplot(ans_df, aes(x = time)) +
  facet_wrap(vars(age)) +
  geom_ribbon(aes(ymin = .lower, ymax = .upper, fill = sex),
              alpha = 0.6) +
  geom_line(aes(y = .fitted, color = sex)) +
  geom_point(aes(y = .observed, color = sex),
             size = 0.25)
```


```{r}
age_effect <- components(ans, what = "age_effect") %>%
  mutate(age = poputils::age_mid(age))
ggplot(age_effect, aes(x = age)) +
  facet_wrap(vars(sex)) +
  geom_ribbon(aes(ymin = .lower, ymax = .upper),
              alpha = 0.6) +
  geom_line(aes(y = .fitted))
```



```{r}
time_effect <- components(ans, what = "time_effect") 
ggplot(time_effect, aes(x = time)) +
  facet_wrap(vars(sex)) + 
  geom_ribbon(aes(ymin = .lower, ymax = .upper),
              alpha = 0.6) +
  geom_line(aes(y = .fitted))
```